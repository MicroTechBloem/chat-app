<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zyra Messaging</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.css"/>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --chat-bg: #f0f0f0;
      --bubble-in: #3a7bd5;
      --bubble-out: #e5e5ea;
    }
    body.dark {
      --bg-color: #121212;
      --text-color: #ffffff;
      --chat-bg: #1e1e1e;
      --bubble-in: #3a7bd5;
      --bubble-out: #333333;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      height: 100vh;
      display: flex;
    }

    #sidebar {
      width: 280px;
      background-color: var(--chat-bg);
      border-right: 1px solid #ccc;
      padding: 15px;
      overflow-y: auto;
    }

    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: var(--bubble-in);
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-window {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: var(--chat-bg);
    }

    .message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
      max-width: 70%;
      word-wrap: break-word;
    }

    .incoming {
      background-color: var(--bubble-out);
      align-self: flex-start;
    }

    .outgoing {
      background-color: var(--bubble-in);
      color: white;
      align-self: flex-end;
    }

    #message-box {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ccc;
    }

    #message-input {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 5px;
    }

    .emoji-picker {
      position: absolute;
      bottom: 60px;
      right: 20px;
    }

    .theme-toggle {
      cursor: pointer;
    }

    #chat-controls button {
      margin-left: 5px;
    }

    .contact {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }

    .contact:hover {
      background-color: #d6e4ff;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h5>Contacts</h5>
    <div id="contact-list">
      <div class="contact">John Doe</div>
      <div class="contact">Jane Smith</div>
      <div class="contact">Zanele Masuku</div>
    </div>
    <button onclick="toggleTheme()" class="btn btn-sm btn-secondary mt-3">Toggle Light/Dark</button>
  </div>

  <div id="main">
    <header>
      <span>Zyra Messaging</span>
      <div>
        <i class="fas fa-video mx-2" title="Video Call"></i>
        <i class="fas fa-phone mx-2" title="Voice Call"></i>
        <i class="fas fa-sign-out-alt mx-2" title="Sign Out" onclick="signOut()"></i>
      </div>
    </header>

    <div id="chat-window" class="d-flex flex-column">
      <!-- Messages will be inserted here -->
    </div>

    <div id="message-box">
      <input type="text" id="message-input" placeholder="Type a message..." class="form-control" />
      <div id="chat-controls">
        <button class="btn btn-light" onclick="toggleEmoji()">ðŸ˜Š</button>
        <input type="file" id="upload" hidden onchange="sendFile(this.files[0])" />
        <button class="btn btn-light" onclick="document.getElementById('upload').click()">ðŸ“Ž</button>
        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
      </div>
    </div>

    <emoji-picker style="display: none;" class="emoji-picker" id="emojiPicker"></emoji-picker>
  </div>

  <script type="module">
    import { getAuth, signOut as firebaseSignOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const emojiPicker = document.getElementById('emojiPicker');
    const input = document.getElementById('message-input');
    const chatWindow = document.getElementById('chat-window');

    emojiPicker.addEventListener('emoji-click', event => {
      input.value += event.detail.unicode;
      emojiPicker.style.display = 'none';
    });

    window.toggleEmoji = () => {
      emojiPicker.style.display = emojiPicker.style.display === 'none' ? 'block' : 'none';
    };

    window.toggleTheme = () => {
      document.body.classList.toggle('dark');
    };

    window.sendMessage = () => {
      const msg = input.value.trim();
      if (!msg) return;
      const div = document.createElement('div');
      div.className = 'message outgoing';
      div.innerText = msg;
      chatWindow.appendChild(div);
      input.value = '';
      chatWindow.scrollTop = chatWindow.scrollHeight;
    };

    window.sendFile = (file) => {
      const div = document.createElement('div');
      div.className = 'message outgoing';
      if (file.type.startsWith("image/")) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.style.maxWidth = '200px';
        div.appendChild(img);
      } else {
        div.innerHTML = `<i class="fas fa-file"></i> ${file.name}`;
      }
      chatWindow.appendChild(div);
    };

    window.signOut = () => {
      const auth = getAuth();
      firebaseSignOut(auth).then(() => {
        window.location.href = "/";
      });
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js" type="module"></script>
</body>
</html>
